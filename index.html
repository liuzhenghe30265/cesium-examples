<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.103/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.103/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

    <style lang="scss" scoped>
        #cesiumContainer {
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }

        #slider {
            position: absolute;
            left: 50%;
            top: 0px;
            background-color: #d3d3d3;
            width: 5px;
            height: 100%;
            z-index: 9999;
            cursor: ew-resize;
        }
    </style>

</head>

<body>
    <div id="cesiumContainer">
        <div id="slider" />
    </div>
    <script>
        const china = Cesium.Rectangle.fromDegrees(100, 10, 120, 70)
        Cesium.Camera.DEFAULT_VIEW_RECTANGLE = china
        // Initialize the viewer widget with several custom options and mixins.
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjYTJjNTM1Yy0wZDRjLTRlZWYtYTFkMi1hOGIwNTI2ZGU0MDgiLCJpZCI6ODI5MjAsImlhdCI6MTY0NTE2NDEyOH0.XndixRDpLnRAxnqSNQpT2JofpGyngIUWlmzbG53hEtM'
        const viewer = new Cesium.Viewer('cesiumContainer', {
            terrainProvider: Cesium.createWorldTerrain(),
            animation: false, // 是否显示左下角的仪表盘
            baseLayerPicker: true, // 是否显示图层选择器按钮，右上角那个地图图标
            fullscreenButton: true, // 是否显示全屏按钮
            vrButton: true, // 是否显示VR按钮
            geocoder: true, // 是否显示搜索按钮
            homeButton: true, // 是否显示主页按钮
            infoBox: false, // 是否显示提示信息
            sceneModePicker: true, // 是否显示右上角的模式切换按钮
            selectionIndicator: false, // 是否显示选取指示器组件
            timeline: true, // 是否显示下边的时间轴
            navigationHelpButton: false, // 是否显示右上角的帮助按钮
            navigationInstructionsInitiallyVisible: true, // 是否显示导航
            // scene3DOnly: true, // 是否指定仅为三维模式，全部使用三维模式可节约 GPU 资源
            // requestRenderMode: true,
            imageryProvider: new Cesium.ArcGisMapServerImageryProvider({
                url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer'
            }),
            contextOptions: {
                allowTextureFilterAnisotropic: false,
                webgl: {
                    alpha: true
                },
                requestWebgl1: true
            }
        })
        window.viewer = viewer

        setTimeout(async () => {
            try {
                const left = await new Cesium.Cesium3DTileset({
                    url: './model/terra_b3dms/tileset.json',
                    debugShowMemoryUsage: false
                })
                viewer.scene.primitives.add(left)
                left.splitDirection = Cesium.SplitDirection.LEFT

                viewer.zoomTo(left)

                // const left = await new Cesium.Cesium3DTileset({
                //     url: './model/truck/a/terra_b3dms/tileset.json',
                //     // url: 'https://lab.earthsdk.com/model/3610c2b0d08411eab7a4adf1d6568ff7/tileset.json',
                //     debugShowMemoryUsage: false
                // })
                // viewer.scene.primitives.add(left)
                // left.splitDirection = Cesium.SplitDirection.LEFT

                // viewer.zoomTo(left)

                // const right = await new Cesium.Cesium3DTileset({
                //     url: './model/truck/b/terra_b3dms/tileset.json',
                //     // url: 'https://lab.earthsdk.com/model/908311a0ac2f11e99dbd8fd044883638/tileset.json',
                //     debugShowMemoryUsage: false
                // })
                // viewer.scene.primitives.add(right)
                // right.splitDirection = Cesium.SplitDirection.RIGHT

                var model = viewer.scene.primitives.add(Cesium.Model.fromGltf({
                    url: './model/qxxz.glb',
                    modelMatrix: Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(102.73, 25.04, 0))
                }))
            } catch (error) {
                console.log(`Error loading tileset: ${error}`)
            }

            const slider = document.getElementById('slider')
            viewer.scene.splitPosition =
                slider.offsetLeft / slider.parentElement.offsetWidth

            const handler = new Cesium.ScreenSpaceEventHandler(slider)

            let moveActive = false

            function move(movement) {
                if (!moveActive) {
                    return
                }

                const relativeOffset = movement.endPosition.x
                const splitPosition =
                    (slider.offsetLeft + relativeOffset) / slider.parentElement.offsetWidth
                slider.style.left = `${100.0 * splitPosition}%`
                viewer.scene.splitPosition = splitPosition
            }

            handler.setInputAction(function () {
                moveActive = true
            }, Cesium.ScreenSpaceEventType.LEFT_DOWN)
            handler.setInputAction(function () {
                moveActive = true
            }, Cesium.ScreenSpaceEventType.PINCH_START)

            handler.setInputAction(move, Cesium.ScreenSpaceEventType.MOUSE_MOVE)
            handler.setInputAction(move, Cesium.ScreenSpaceEventType.PINCH_MOVE)

            handler.setInputAction(function () {
                moveActive = false
            }, Cesium.ScreenSpaceEventType.LEFT_UP)
            handler.setInputAction(function () {
                moveActive = false
            }, Cesium.ScreenSpaceEventType.PINCH_END)

        })


    </script>
    <style>
        #cesiumContainer {
            width: 100%;
            height: 100%;
        }
    </style>
</body>

</html>